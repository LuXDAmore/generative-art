(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{647:function(e,n,t){"use strict";t.r(n);t(18),t(10),t(28);var o=t(13),r=t(3),c=t(9);function l(object,e){var n=Object.keys(object);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(object);e&&(t=t.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),n.push.apply(n,t)}return n}function v(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?l(Object(source),!0).forEach((function(n){Object(o.a)(e,n,source[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):l(Object(source)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(source,n))}))}return e}var d={animate:!0,context:"webgl",attributes:{antialias:!0}},m={name:"audio-video",data:()=>({sketchManager:null}),mounted(){var e=this;this.$nextTick(Object(r.a)((function*(){try{e.sketchManager=yield e.$sketch(v(v({},d),{},{canvas:e.$refs.canvas}),e.sketch)}catch(e){console.error(e)}})))},beforeDestroy(){this.sketchManager&&this.sketchManager.unload()},methods:{sketch(e){var n=this;return Object(r.a)((function*(){var{context:o,canvas:canvas,width:l,height:v}=e,{OrbitControls:d}=yield t.e(0).then(t.bind(null,424)),m=t(510),f=!1,h=new c.H({context:o}),w=new c.w,y=new c.E,x=new c.r(63,1,.001,1e3),O=new d(x,canvas),U=new c.s(l/v,1,54,54),j=[20,140],_=[400,2600],k=[5200,14e3],D=new c.b,audio=new c.u(D),P=new c.a(audio,2048),M=(data,e)=>{for(var n=Math.round(e[0]/24e3*data.length),t=Math.round(e[1]/24e3*data.length),o=0,r=0,c=n;c<=t;c++)o+=data[c],r+=1;return o/r/255},video=document.createElement("video"),E=function(){var e=Object(r.a)((function*(){canvas.removeEventListener("click",E,!1),n.$refs.title.remove();try{(e=>{audio.gain.gain.value=.001,audio.setMediaStreamSource(e),audio.context.resume()})(yield navigator.mediaDevices.getUserMedia({audio:!0,video:!1}))}catch(e){console.error(e),window.alert("You must allow access to your microphone")}try{(e=>{video.srcObject=e,video.width=l,video.height=v,video.playsinline=!0,video.muted=!0,video.autoplay=!0,video.addEventListener("canplaythrough",(()=>S.uniforms.video.value.needsUpdate=!0)),video.play()})(navigator.mediaDevices.getUserMedia({video:{width:l,height:v,facingMode:"user"},audio:!1}))}catch(e){console.error(e),window.alert("You must allow access to your webcam")}}));return function(){return e.apply(this,arguments)}}(),S=new c.y({vertexShader:"#define GLSLIFY 1\n#pragma vscode_glsllint_stage : vert\n\nvarying vec2 vUv;\nvarying vec3 vPosition;\n\nvoid main () {\n\n    vUv = uv;\n\n    vPosition = position;\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n}\n",fragmentShader:"#define GLSLIFY 1\n#pragma vscode_glsllint_stage : frag\n\nuniform sampler2D microphone;\nuniform sampler2D video;\n\nuniform float bass;\nuniform float mid;\nuniform float treble;\n\nuniform float time;\n\nuniform vec3 mouse;\nuniform float mouse_radius;\n\nvarying vec3 vPosition;\n\nvarying vec2 vUv;\n\nfloat map(\n    float value,\n    float min1,\n    float max1,\n    float min2,\n    float max2\n) {\n\n    return min2 + ( value - min1 ) * ( max2 - min2 ) / ( max1 - min1 );\n\n}\n\nvoid main() {\n\n    vec3 webcam = texture2D(\n        video,\n        vUv\n    ).rgb;\n\n    vec2 displacedUv = vec2(\n        vUv.x,\n        vUv.y\n    );\n\n    displacedUv.y = mix(\n        vUv.y,\n        bass,\n        1.0\n    );\n    displacedUv.x = mix(\n        vUv.x,\n        mid,\n        treble\n    );\n\n    float dist = length( vPosition - mouse );\n    float prox = 1. - map(\n        dist,\n        0.,\n        mouse_radius,\n        0.,\n        1.\n    );\n\n    prox = clamp(\n        prox,\n        0.,\n        1.\n    );\n\n    // Microphone\n    vec3 backgroundColor = vec3( displacedUv.y, displacedUv.x, prox );\n\n    float f = texture2D( microphone, vec2( displacedUv.x, 0.0 ) ).r;\n    float g = texture2D( microphone, vec2( displacedUv.x, 0.0 ) ).g;\n    float b = texture2D( microphone, vec2( displacedUv.x, 0.0 ) ).b;\n\n    vec3 color = vec3( f, g, b );\n\n    float i = sin( step( vUv.y, f ) * step( f - 0.0125, vUv.y ) );\n\n    // Webcam\n    webcam.r = webcam.r + ( 1. - bass );\n    webcam.g = webcam.g + ( 1. - treble );\n    webcam.b = webcam.b + ( 1. - mid );\n\n    // Color mixer\n    vec4 mixed = vec4( mix( webcam, mix( backgroundColor, color, i ), bass ), 1.0 );\n\n    gl_FragColor = mixed;\n\n}\n",extensions:{derivatives:"#extension GL_OES_standard_derivatives : enable"},side:c.i,uniforms:{time:{type:"f",value:0},mouse_radius:{type:"f",value:.3},bass:{type:"f",value:0},mid:{type:"f",value:0},treble:{type:"f",value:0},video:{type:"t",value:new c.G(video)},microphone:{type:"t",value:new c.g(P.data,1024,1,c.m)},mouse:{type:"v3",value:y},resolution:{type:"v2",value:new c.D(l,v)},uvRate1:{value:new c.D(1,1)}}}),C=new c.o(U,S),L=new c.x,F={mouse_radius:.3},G=new m.GUI;return canvas.addEventListener("click",E,!1),canvas.addEventListener("mousemove",(e=>{y.x=e.clientX/window.innerWidth*2-1,y.y=-e.clientY/window.innerHeight*2+1,w.setFromCamera(y,x);var[n]=w.intersectObjects(L.children),t=n&&n.point?n.point:null;f=!!t}),!1),x.position.set(0,0,1),L.add(C),G.add(F,"mouse_radius",0,1,.1),G.close(),{resize(e){var{pixelRatio:n,viewportWidth:t,viewportHeight:o}=e;h.setPixelRatio(n),h.setSize(t,o),S.uniforms.resolution.value.x=t,S.uniforms.resolution.value.y=o,x.aspect=t/o,x.updateProjectionMatrix()},render(e){var{time:time}=e,data=P.getFrequencyData(),n=M(data,j),t=M(data,_),o=M(data,k);S.uniforms.bass.value=n,S.uniforms.mid.value=t,S.uniforms.treble.value=o,S.uniforms.microphone.value.needsUpdate=!0,S.uniforms.time.value=time,S.uniforms.mouse_radius.value=F.mouse_radius,f&&(S.uniforms.mouse.value=y),O.update(),h.render(L,x)},unload(){audio.context.suspend(),G.destroy(),h.dispose()}}}))()}}},f=t(12),component=Object(f.a)(m,(function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("main",{staticClass:"container canvas-container"},[t("h6",{ref:"title",staticClass:"absolute z-index--1 text--center text--red no-pointer-event cursor--pointer"},[e._v(" Click on the canvas"),t("br"),t("small",[e._v("(allow access to camera and microphone)")])]),t("canvas",{ref:"canvas"})])}),[],!1,null,null,null);n.default=component.exports}}]);